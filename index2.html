<!DOCTYPE html>
<html lang="lang">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sand Simulator</title>
    <style>
        canvas {
            border: 1px solid black;
            background: black;
        }
    </style>
</head>
<body>
    <canvas id="sandCanvas"></canvas>
    <script>
        const canvas = document.getElementById('sandCanvas');
        const ctx = canvas.getContext('2d');
        const size = 5;
        const fps = 15;
        const width = 800;
        const height = 600;
        canvas.width = width;
        canvas.height = height;

        const grid = Array(Math.floor(height / size)).fill(null)
            .map(() => Array(Math.floor(width / size)).fill(0));

        let isMousePressed = false;
        let mouseX = 0;
        let mouseY = 0;

        function createSand(x, y) {
            const gridX = Math.floor(x / size);
            const gridY = Math.floor(y / size);
            if (gridY >= 0 && gridY < grid.length && gridX >= 0 && gridX < grid[0].length) {
                grid[gridY][gridX] = 1;
            }
        }

        function updateSand() {
            for (let y = grid.length - 1; y >= 0; y--) {
                for (let x = 0; x < grid[y].length; x++) {
                    if (grid[y][x] === 1) {
                        if (y + 1 < grid.length && grid[y + 1][x] === 0) {
                            grid[y + 1][x] = 1;
                            grid[y][x] = 0;
                        } else if (y + 1 < grid.length && x - 1 >= 0 && grid[y + 1][x - 1] === 0) {
                            grid[y + 1][x - 1] = 1;
                            grid[y][x] = 0;
                        } else if (y + 1 < grid.length && x + 1 < grid[y].length && grid[y + 1][x + 1] === 0) {
                            grid[y + 1][x + 1] = 1;
                            grid[y][x] = 0;
                        }
                    }
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, width, height);
            for (let y = 0; y < grid.length; y++) {
                for (let x = 0; x < grid[y].length; x++) {
                    if (grid[y][x] === 1) {
                        ctx.fillStyle = 'yellow';
                        ctx.fillRect(x * size, y * size, size, size);
                    }
                }
            }
        }

        const frameTime = 1000/fps;
        let lastRun = 0;

        function gameLoop(time) {
            requestAnimationFrame(gameLoop);
            if (time - lastRun < frameTime) {
                return;
            } 
            lastRun = time;
            if (isMousePressed) {
                createSand(mouseX, mouseY);
            }
            updateSand();
            draw();
        }

        canvas.addEventListener('mousedown', (event) => {
            isMousePressed = true;
            updateMousePosition(event);
        });
        canvas.addEventListener('mouseup', () => isMousePressed = false);
        canvas.addEventListener('mousemove', updateMousePosition);
        canvas.addEventListener('mouseleave', () => isMousePressed = false);

        function updateMousePosition(event) {
            const rect = canvas.getBoundingClientRect();
            mouseX = event.clientX - rect.left;
            mouseY = event.clientY - rect.top;
        }

    requestAnimationFrame(gameLoop);
    </script>
</body>
</html>